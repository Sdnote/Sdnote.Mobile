<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/app.css" />
		<link href="css/mui.picker.min.css" rel="stylesheet" />
		<style>
			html,
			body,
			.mui-content {
				height: 0px;
				margin: 0px;
				background-color: #efeff4;
			}
			h5.mui-content-padded {
				margin-left: 3px;
				margin-top: 20px !important;
			}
			h5.mui-content-padded:first-child {
				margin-top: 12px !important;
			}
			.ui-alert {
				text-align: center;
				padding: 20px 10px;
				font-size: 16px;
			}
			* {
				-webkit-touch-callout: none;
				-webkit-user-select: none;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">添加</h1>
		</header>
		<div class="mui-content">		
			<div class="mui-card">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell mui-collapse mui-active">
						<a class="mui-navigate-right " href="#">添加日程</a>
						<div class="mui-collapse-content">
							<a href="ttst.html"></a>
							<form class="mui-input-group">
								<div class="mui-input-row">
									<label>标题</label>
									<input type="text" id = "rTitle"  class=" mui-input-speech mui-input-clear" placeholder="输入日程标题">
								</div>
								<div class="mui-input-row">
									<label>标签Tag</label>
									<input type="text" class="mui-input-clear" placeholder="输入日程标签 Tag">
								</div>
								<div class="mui-input-row">
									<label>开始时间</label>
									<label id="result" style="width: auto;"></label>
									<button id='demo1' data-options='{}'  class="btn mui-btn">⏱</button>							
								</div>
								<div class="mui-input-row">
									<label>结束时间</label>
									<label id="result1" style="width: auto;"></label>
									<button id='demo1' data-options='{}'  class="btn1 mui-btn">⏱</button>							
								</div>
								<div class="mui-input-row">
									<label>提醒时间</label>
									<label id="result2" style="width: auto;"></label>
									<button id='demo1' data-options='{}'  class="btn2 mui-btn">⏱</button>			
								</div>
								<div class="mui-input-row" style="margin: 10px 5px; height: auto;">
					                <textarea id="Remindtextarea" rows="5" placeholder="提醒内容" class="mui-input-speech mui-input-clear"></textarea>
					            </div>
								<div class="mui-button-row">
									<button class="mui-btn mui-btn-primary" type="button" onclick="addRemind()">确认</button>
									<!--<button class="mui-btn mui-btn-primary" type="button" onclick="return false;">取消</button>-->
								</div>
							</form>
						</div>
					</li>
					<li class="mui-table-view-cell mui-collapse">
						<a class="mui-navigate-right" href="#">添加笔记</a>
						<div class="mui-collapse-content">
							<form class="mui-input-group">
								<div class="mui-input-row">
									<label>标题</label>
									<input type="text" id = "nTitle"  class=" mui-input-speech mui-input-clear" placeholder="输入日程标题">
								</div>
								<div class="mui-input-row">
									<label>标签Tag</label>
									<input type="text" id = "nTag" class="mui-input-clear" placeholder="输入日程标签 Tag">
								</div>
								
								<div class="mui-input-row" style="margin: 10px 5px; height: auto;">
					                <textarea id="Notetextarea" rows="5" placeholder="笔记内容" class="mui-input-speech mui-input-clear"></textarea>
					            </div>
								
								
								<div class="mui-button-row">
									<button class="mui-btn mui-btn-primary" type="button" onclick="addNote()">添加</button>
									<!--<button class="mui-btn mui-btn-primary" type="button" onclick="return false;">取消</button>-->
								</div>
							</form>
						</div>
					</li>
				</ul>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/mui.picker.min.js"></script>
		<script type="text/javascript">
			mui.init({
				//swipeBack:true //启用右滑关闭功能
			});
			mui.ready(function() {
                mui('.mui-input-row textarea').input();
            });
			(function($) {
				$.init();
				var result = $('#result')[0];
				var btns = $('.btn');
				btns.each(function(i, btn) {
					btn.addEventListener('tap', function() {
						var _self = this;
						if(_self.picker) {
							_self.picker.show(function (rs) {
								result.innerText =  rs.text;
								_self.picker.dispose();
								_self.picker = null;
							});
						} else {
							var optionsJson = this.getAttribute('data-options') || '{}';
							var options = JSON.parse(optionsJson);
							var id = this.getAttribute('id');
							_self.picker = new $.DtPicker(options);
							_self.picker.show(function(rs) {
								result.innerText =  rs.text;
								_self.picker.dispose();
								_self.picker = null;
							});
						}
						
					}, false);
				});
			})(mui);
			
			//二
			(function($) {
				$.init();
				var result = $('#result1')[0];
				var btns = $('.btn1');
				btns.each(function(i, btn) {
					btn.addEventListener('tap', function() {
						var _self = this;
						if(_self.picker) {
							_self.picker.show(function (rs) {
								result.innerText =  rs.text;
								_self.picker.dispose();
								_self.picker = null;
							});
						} else {
							var optionsJson = this.getAttribute('data-options') || '{}';
							var options = JSON.parse(optionsJson);
							var id = this.getAttribute('id');
							_self.picker = new $.DtPicker(options);
							_self.picker.show(function(rs) {
								result.innerText =  rs.text;
								_self.picker.dispose();
								_self.picker = null;
							});
						}
						
					}, false);
				});
			})(mui);
			
			//三
			(function($) {
				$.init();
				var result = $('#result2')[0];
				var btns = $('.btn2');
				btns.each(function(i, btn) {
					btn.addEventListener('tap', function() {
						var _self = this;
						if(_self.picker) {
							_self.picker.show(function (rs) {
								result.innerText =  rs.text;
								_self.picker.dispose();
								_self.picker = null;
							});
						} else {
							var optionsJson = this.getAttribute('data-options') || '{}';
							var options = JSON.parse(optionsJson);
							var id = this.getAttribute('id');
							_self.picker = new $.DtPicker(options);
							_self.picker.show(function(rs) {
								result.innerText =  rs.text;
								_self.picker.dispose();
								_self.picker = null;
							});
						}
						
					}, false);
				});
			})(mui);
			
			//添加笔记事件
			function addNote()
			{
				var xhr = new plus.net.XMLHttpRequest();
				//预处理请求
				xhr.open("POST", "http://dstantside.com/Sdnote/api/Note/add");
				//参数
				var info = {};
				var attr1 = "Token";
				var attr2 = "UserID";
				var attr3 = "Title";
				var attr4 = "time";
				var attr5 = "Content";
				var attr6 = "Tag";
				info[attr1] = plus.storage.getItem('uToken');
				info[attr2] = plus.storage.getItem('uId'); 
				info[attr3] = document.getElementById("nTitle").value;
				Date.prototype.Format = function (fmt) { //author: meizz
			    var o = {
			        "M+": this.getMonth() + 1, //月份
			        "d+": this.getDate(), //日
			        "h+": this.getHours(), //小时
			        "m+": this.getMinutes(), //分
			        "s+": this.getSeconds(), //秒
			        "q+": Math.floor((this.getMonth() + 3) / 3), //季度
			        "S": this.getMilliseconds() //毫秒
				    };
				    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
				    for (var k in o)
				    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
				    return fmt;
				}
				info[attr4] = new Date().Format("yyyy-MM-dd hh:mm");
				info[attr5] = document.getElementById("Notetextarea").value;
				info[attr6] = document.getElementById("nTag").value;
				console.log(JSON.stringify(info));
				//设置请求头
				xhr.setRequestHeader('Content-Type','application/json');
				// 发送HTTP请求
				//console.log(user);
				xhr.send(info);	

				xhr.onreadystatechange = function (){
				    if ( xhr.status == 200 ) {
				        //console.log( "xhr请求成功："+xhr.responseText);
				      	var noteList = JSON.parse(xhr.responseText);
				      	console.log(xhr.responseText);
				      	plus.nativeUI.toast('笔记添加成功！~');	
				      	mui.back();
				    } else {
				        //console.log( "xhr请求失败："+xhr.status );
				        plus.nativeUI.toast('异常！');
				    }
				}				
			}
			
			//添加提醒
			function addRemind()
			{
				
			}
		</script>
	</body>

</html>